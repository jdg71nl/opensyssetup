#!/bin/bash
#= node_modules--clean-all-sub.sh | updated: d220705
# (c)2022 John@de-Graaff.net
#
#BASENAME=`basename $0`
#SCRIPT=`realpath -s $0`  # man says: "-s, --strip, --no-symlinks : don't expand symlinks"
#SCRIPT_PATH=`dirname $SCRIPT`
#MYUID=$( id -u )
#usage() {
#  #echo "# usage: $BASENAME { req.flag | [ -opt.flag string ] } " 1>&2 
#  echo "# usage: $BASENAME " 1>&2 
#  exit 1
#}
#if [ $MYUID != 0 ]; then
#  echo "# provide your password for 'sudo':" ; sudo "$0" "$@" ; exit 1 ;
#fi
#if [ -f ${SOME_FILE} ]; then
#else
#fi
#
do_for_dir() {
  echo "# cleaning: '$1' ..."
  cd "$1" 
  rm -rf * 
  rm -f .package-lock.json
  rm -rf .bin
  rm -rf .cache
  touch .keep 
  #ls -altr
  cd - 
}
# https://stackoverflow.com/questions/4321456/find-exec-a-shell-function-in-linux
export -f do_for_dir
find . -type d -regex ".*\/node_modules" -prune -exec bash -c 'do_for_dir "$0"' {} \;
#
find . -type f -name "package-lock.json" -exec echo "# rm {} ..." \; -exec rm {} \;
#
exit 0
#
#-eof
